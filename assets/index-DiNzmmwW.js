(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function i(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(t){if(t.ep)return;t.ep=!0;const a=i(t);fetch(t.href,a)}})();const d=(h,s,i)=>Math.max(s,Math.min(i,h));function y(h,s,i,e,t,a,o){const r=d(h,e,e+a),l=d(s,t,t+o),n=h-r,u=s-l;return n*n+u*u<=i*i}const p={volume:"breakout.volume",muted:"breakout.muted"};class v{sounds={};enabled=!0;volume=1;constructor(){try{const s=localStorage.getItem(p.volume);if(s!=null){const e=parseFloat(s);this.volume=d(e,0,1)}const i=localStorage.getItem(p.muted);i!=null&&(this.enabled=i!=="1")}catch(s){console.error("Error loading audio settings from localStorage:",s)}}async load(s,i){return new Promise((e,t)=>{try{const a=new Audio(i);a.preload="auto",a.oncanplaythrough=()=>e(),a.onerror=()=>t(new Error(`audio load error: ${i}`)),this.sounds[s]=a}catch(a){t(a)}})}async loadAll(s){await Promise.all(s.map(([i,e])=>this.load(i,e)))}play(s,i){if(!this.enabled)return;const e=this.sounds[s];if(!e)return console.warn(`AudioManager: sound '${s}' not found/loaded`);try{const t=e.cloneNode(!0),a=(i?.volume??1)*this.volume;t.volume=d(a,0,1),t.loop=i?.loop??!1,t.play()}catch(t){console.error(`Error playing sound '${s}':`,t)}}toggleSounds(s){this.enabled=s;try{localStorage.setItem(p.muted,s?"0":"1")}catch(i){console.error("Error saving audio settings to localStorage:",i)}}setVolume(s){this.volume=d(s,0,1);try{localStorage.setItem(p.volume,String(this.volume))}catch(i){console.error("Error saving audio settings to localStorage:",i)}}getVolume(){return this.volume}getEnabled(){return this.enabled}}class f{root;infos;controls;muteBtn;volInput;status;playArea;paddleEl;ballEl;bricksContainer;modal;onWinRestartCb=null;constructor(s,i){this.root=s,this.infos=document.createElement("div"),this.infos.className="infos",this.root.appendChild(this.infos),this.controls=document.createElement("div"),this.controls.style.display="flex",this.controls.style.gap="8px",this.controls.style.alignItems="center",this.controls.style.justifyContent="center",this.controls.style.marginBottom="6px",this.muteBtn=document.createElement("button"),this.muteBtn.textContent="ðŸ”Š",this.muteBtn.title="Mute / Unmute",this.muteBtn.className="mute-btn",this.volInput=document.createElement("input"),this.volInput.type="range",this.volInput.min="0",this.volInput.max="1",this.volInput.step="0.05",this.volInput.value="1",this.volInput.style.width="140px",this.volInput.style.accentColor="#3f51b5",this.status=document.createElement("div"),this.status.id="status",this.status.style.textAlign="center",this.controls.appendChild(this.muteBtn),this.controls.appendChild(this.volInput),this.infos.appendChild(this.controls),this.infos.appendChild(this.status),this.playArea=document.createElement("div"),this.playArea.className="playArea",this.playArea.style.width=i.width+"px",this.playArea.style.height=i.height+"px",this.root.appendChild(this.playArea);const e=document.createElement("p");e.style.fontSize="12px",e.style.textAlign="center",e.style.marginTop="4px",e.textContent="Barre espace pour dÃ©marrer, fleches gauche/droite pour dÃ©placer la raquette!",this.root.appendChild(e),this.paddleEl=document.createElement("div"),this.paddleEl.className="paddle",this.playArea.appendChild(this.paddleEl),this.ballEl=document.createElement("div"),this.ballEl.className="ball",this.playArea.appendChild(this.ballEl),this.bricksContainer=document.createElement("div"),this.bricksContainer.className="bricks",this.playArea.appendChild(this.bricksContainer),this.modal=document.createElement("dialog"),this.modal.className="overlay",this.playArea.appendChild(this.modal);const t=document.createElement("div");t.className="title",t.textContent="Breakout de wish",this.root.prepend(t)}updateInfos(s,i,e){const t=document.getElementById("status");t.textContent=`Score: ${s} | Vies: ${i} | Niveau: ${e}`}onVolumeChange(s){this.volInput.addEventListener("input",()=>{const i=parseFloat(this.volInput.value);s(d(i,0,1))})}onToggleMute(s){let i=this.muteBtn.textContent==="ðŸ”‡";this.muteBtn.addEventListener("click",()=>{i=!i,this.setMuteIcon(i),s(i)})}setMuteIcon(s){this.muteBtn.textContent=s?"ðŸ”‡":"ðŸ”Š"}setVolumeSlider(s){this.volInput.value=d(s,0,1).toString()}updatePaddle(s,i,e,t){Object.assign(this.paddleEl.style,{left:`${s}px`,top:`${i}px`,width:`${e}px`,height:`${t}px`})}updateBall(s,i,e){const t=e*2;Object.assign(this.ballEl.style,{left:`${s-e}px`,top:`${i-e}px`,width:`${t}px`,height:`${t}px`})}renderBricks(s){this.bricksContainer.innerHTML="";for(let i=0;i<s.length;i++){const e=s[i];if(!e.alive)continue;const t=document.createElement("div");t.className="brick",t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.dataset.hits=String(e.hits),t.dataset.idx=String(i),this.bricksContainer.appendChild(t)}}updateBrick(s,i){const e=this.bricksContainer.querySelector(`[data-idx="${s}"]`);if(!i.alive){e&&e.remove();return}if(!e){const a=document.createElement("div");a.className="brick",a.style.left=`${i.x}px`,a.style.top=`${i.y}px`,a.style.width=`${i.width}px`,a.style.height=`${i.height}px`,a.dataset.hits=i.hits.toString(),a.dataset.idx=s.toString(),this.bricksContainer.appendChild(a);return}e.dataset.hits=i.hits.toString(),e.classList.remove("hit"),e.classList.add("hit");const t=()=>{e.classList.remove("hit"),e.removeEventListener("animationend",t)};e.addEventListener("animationend",t)}showWinOverlay(s){this.modal.innerHTML=`
				<h2>Bravo ! Jeu terminÃ© ðŸŽ‰</h2>
				<p class="final-score">Score final: ${s}</p>
				<p class="hint">Cliquez sur Rejouer pour recommencer au niveau 1!</p>
				<button class="btn btn-primary" id="win-restart-btn">Rejouer</button>
		`,document.getElementById("win-restart-btn").addEventListener("click",()=>{this.onWinRestartCb&&this.onWinRestartCb()}),this.modal.showModal()}hideOverlay(){this.modal.close()}setWinRestart(s){this.onWinRestartCb=s}}class g{config;player;ball;paddle;bricks=[];running=!1;awaitingStart=!0;constructor(s){this.config=s,this.player={score:0,lives:3,level:1},this.paddle={width:s.paddleWidth,height:s.paddleHeight,x:(s.width-s.paddleWidth)/2,y:s.height-s.paddleHeight-10,speed:s.paddleSpeed},this.ball={x:this.paddle.x+s.paddleWidth/2,y:this.paddle.y-s.ballRadius-2,radius:s.ballRadius,vx:0,vy:0,speed:s.ballSpeed}}resetBallOnPaddle(){this.awaitingStart=!0,this.ball.x=this.paddle.x+this.paddle.width/2,this.ball.y=this.paddle.y-this.ball.radius-2,this.ball.vx=3*(Math.random()>.5?1:-1),this.ball.vy=-3}}class x{state;dir="none";renderer;rafId=0;root;audio=new v;ending=!1;playTap=this.audio.play.bind(this.audio,"tap");playPop=this.audio.play.bind(this.audio,"pop",{volume:.1});constructor(s,i){this.root=s,this.state=new g(i),this.renderer=new f(s,{width:i.width,height:i.height}),this.audio.loadAll([["tap","fx/tap.wav"],["pop","fx/pop.mp3"],["win","fx/win.wav"],["lose","fx/lose.wav"],["cheer","fx/cheer.wav"],["bg_music","fx/bg_music.mp3"]]).then(()=>{let e=!1;document.addEventListener("pointerdown",()=>{e||(this.audio.play("bg_music",{volume:.25,loop:!0}),e=!0)},{once:!0}),document.addEventListener("keydown",()=>{e||(this.audio.play("bg_music",{volume:.05,loop:!0}),e=!0)},{once:!0})}).catch(e=>console.error("Audio load error:",e)),this.makeLevel(this.state.player.level),window.addEventListener("keydown",e=>{e.key==="ArrowLeft"&&(this.dir="left"),e.key==="ArrowRight"&&(this.dir="right"),e.key===" "&&this.state.awaitingStart&&(this.state.awaitingStart=!1)}),window.addEventListener("keyup",e=>{e.key==="ArrowLeft"&&this.dir==="left"&&(this.dir="none"),e.key==="ArrowRight"&&this.dir==="right"&&(this.dir="none")}),this.updateInfos(),this.renderer.onToggleMute(e=>this.audio.toggleSounds(!e)),this.renderer.onVolumeChange(e=>this.audio.setVolume(e)),this.renderer.setWinRestart(()=>{this.renderer.hideOverlay(),this.state.player={score:0,lives:3,level:1},this.makeLevel(1),this.updateInfos(),this.ending=!1,this.start()}),this.renderer.setMuteIcon(!this.audio.getEnabled()),this.renderer.setVolumeSlider(this.audio.getVolume())}start(){this.state.running=!0,this.loop()}stop(){this.state.running=!1,cancelAnimationFrame(this.rafId)}makeLevel(s){const i=this.state.config,e=i.levelLayouts[s-1],t=[];if(e&&e.length>0){const a=e.length,o=Math.max(...e.map(n=>n?.length??0)),r=o*i.brickWidth+Math.max(0,o-1)*i.brickGap,l=Math.max(i.brickGap,Math.floor((i.width-r)/2));for(let n=0;n<a;n++)for(let u=0;u<(e[n]?.length??0);u++){const c=e[n][u]??0;c<=0||t.push({x:l+u*(i.brickWidth+i.brickGap),y:n*(i.brickHeight+i.brickGap)+i.brickGap+40,width:i.brickWidth,height:i.brickHeight,hits:c,alive:!0})}}this.state.bricks=t,this.renderer.renderBricks(t),this.state.resetBallOnPaddle()}updateInfos(){const{score:s,lives:i,level:e}=this.state.player;this.renderer.updateInfos(s,i,e)}loop=()=>{this.state.running&&(this.rafId=requestAnimationFrame(this.loop),this.update(),this.draw())};update(){const{awaitingStart:s,player:i,paddle:e,ball:t,config:a,bricks:o}=this.state;if(this.dir==="left"?e.x-=e.speed:this.dir==="right"&&(e.x+=e.speed),e.x=d(e.x,0,a.width-e.width),s){t.x=e.x+e.width/2,t.y=e.y-t.radius-2;return}if(t.x+=t.vx*t.speed,t.y+=t.vy*t.speed,(t.x-t.radius<=.1||t.x+t.radius>=a.width)&&(t.vx*=-1),t.y-t.radius<=.1&&(t.vy*=-1),t.y-t.radius>a.height){i.lives-=1,this.updateInfos(),i.lives<=0?this.gameOver():this.state.resetBallOnPaddle();return}if(t.y+t.radius>=e.y&&t.y-t.radius<=e.y+e.height&&t.x+t.radius>=e.x&&t.x-t.radius<=e.x+e.width&&t.vy>0){t.vy*=-1;const r=(t.x-(e.x+e.width/2))/(e.width/2);t.vx=3*r}for(let r=0;r<o.length;r++){const l=o[r];if(l.alive&&y(t.x,t.y,t.radius,l.x,l.y,l.width,l.height)){const n=d(t.x,l.x,l.x+l.width),u=d(t.y,l.y,l.y+l.height),c=t.x-n,m=t.y-u;Math.abs(c)>Math.abs(m)?(t.vx*=-1,c>0?t.x=l.x+l.width+t.radius:t.x=l.x-t.radius):(t.vy*=-1,m>0?t.y=l.y+l.height+t.radius:t.y=l.y-t.radius),l.hits-=1,l.hits<=0?(l.alive=!1,i.score+=10,this.updateInfos(),this.renderer.updateBrick(r,l),this.playPop()):(this.renderer.updateBrick(r,l),this.playTap());break}}if(o.every(r=>!r.alive)){const r=i.level+1;if(r>a.levelLayouts.length){this.ending||(this.ending=!0,this.stop()),this.win();return}const l=3+(r-1);i.level=r,i.lives=l,this.makeLevel(r),this.updateInfos()}}draw(){const{paddle:s,ball:i}=this.state;this.renderer.updatePaddle(s.x,s.y,s.width,s.height),this.renderer.updateBall(i.x,i.y,i.radius)}reset(s){this.stop(),s?(this.audio.play("cheer"),this.audio.play("win"),this.renderer.showWinOverlay(this.state.player.score),this.ending=!0):(this.audio.play("lose"),this.state.player={score:0,lives:3,level:1},this.makeLevel(1),this.updateInfos(),this.ending=!1,this.start())}gameOver(){this.reset(!1)}win(){this.reset(!0)}}const b=document.getElementById("app"),w={width:692,height:600,paddleWidth:100,paddleHeight:12,ballRadius:7,brickRows:4,brickCols:8,brickWidth:70,brickHeight:20,brickGap:6,ballSpeed:1,paddleSpeed:4,levelLayouts:[[[1,1,1,1,1,1,1,1,1],[1,1,0,2,4,2,0,1,1],[1,1,1,2,0,2,1,1,1]],[[2,1,2,1,0,2,1,2,1],[1,2,1,2,0,1,2,1,2],[2,1,2,1,0,2,1,2,1],[1,2,1,2,0,1,2,1,2]],[[3,1,1,1,1,1,1,1,3],[4,3,2,3,4,3,2,3,4],[4,1,3,4,4,4,3,1,4],[2,1,1,3,3,3,1,1,2]]]},E=new x(b,w);E.start();
